<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/jpeg" href="./assets/whitezebra.jpeg">
    <title>Blog Post - Whitezebra Consulting</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.8;
            color: #333;
        }

        /* Blog Post Layout - 3 columns */
        .blog-post-layout {
            max-width: 1400px;
            margin: 100px auto 0;
            padding: 3rem 2rem;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 3rem;
        }

        /* Table of Contents - LEFT */
        .toc-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .toc-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .toc-card h3 {
            font-size: 1rem;
            font-weight: 700;
            color: #1a365d;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-list li {
            margin-bottom: 0.75rem;
        }

        .toc-list a {
            color: #64748b;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: block;
            padding: 0.25rem 0;
        }

        .toc-list a:hover,
        .toc-list a.active {
            color: #2d6bc9;
            font-weight: 600;
            padding-left: 0.5rem;
        }

        /* Main Content - MIDDLE */
        .main-content {
            min-width: 0; /* Prevents overflow */
        }

        .post-header {
            margin-bottom: 2rem;
        }

        .post-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .post-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #64748b;
            font-size: 0.9rem;
        }

        .post-meta-item i {
            color: #2d6bc9;
        }

        .post-title {
            font-size: 2.5rem;
            color: #1a365d;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .post-excerpt {
            font-size: 1.2rem;
            color: #555;
            font-style: italic;
            border-left: 4px solid #38b2ac;
            padding-left: 1.5rem;
            margin: 2rem 0;
        }

        .post-image {
            width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 2rem 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .post-content h2 {
            font-size: 1.8rem;
            color: #1a365d;
            margin: 2.5rem 0 1rem;
            scroll-margin-top: 100px; /* For TOC scroll */
        }

        .post-content p {
            margin-bottom: 1.5rem;
            font-size: 1.05rem;
            color: #374151;
        }

        .post-tags {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
        }

        .tag {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: #e0f2fe;
            color: #1a56db;
            border-radius: 50px;
            font-size: 0.85rem;
            margin: 0.25rem;
        }

        /* Related Posts - RIGHT */
        .related-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .related-card {
            background: #fff;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .related-card h3 {
            font-size: 1rem;
            font-weight: 700;
            color: #1a365d;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .related-post {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .related-post:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .related-post-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #1a365d;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
            line-height: 1.4;
            transition: color 0.2s;
        }

        .related-post-title:hover {
            color: #2d6bc9;
        }

        .related-post-meta {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .blog-post-layout {
                grid-template-columns: 240px 1fr 280px;
                gap: 2rem;
            }
        }

        @media (max-width: 992px) {
            .blog-post-layout {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .toc-sidebar,
            .related-sidebar {
                position: static;
            }

            .toc-card,
            .related-card {
                margin-bottom: 2rem;
            }
        }

        @media (max-width: 768px) {
            .post-title {
                font-size: 2rem;
            }

            .blog-post-layout {
                padding: 2rem 1rem;
                margin-top: 80px;
            }
        }

        /* Back button */
        .back-to-blog {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #2d6bc9;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 2rem;
            transition: gap 0.3s;
        }

        .back-to-blog:hover {
            gap: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="mainNav">
        <div class="nav-container">
            <div class="logo">
                <img src="./assets/whitezebra.jpeg" alt="Whitezebra Consulting" class="logo-img">
                <a href="../index.html" class="logo-text">Whitezebra Consulting</a>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="../index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="services.html">Services</a></li>
                <li><a href="blog.html" class="active">Blog</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="mobile-menu" id="mobileMenu" onclick="toggleMenu()">
                <span class="bar bar1"></span>
                <span class="bar bar2"></span>
                <span class="bar bar3"></span>
            </div>
        </div>
    </nav>

    <!-- Blog Post Layout -->
    <div class="blog-post-layout">
        <!-- Table of Contents - LEFT -->
        <aside class="toc-sidebar">
            <div class="toc-card">
                <h3><i class="fas fa-list"></i> Table of Contents</h3>
                <ul class="toc-list" id="tocList">
                    <!-- Generated dynamically -->
                </ul>
            </div>
        </aside>

        <!-- Main Content - MIDDLE -->
        <article class="main-content">
            <a href="blog.html" class="back-to-blog">
                <i class="fas fa-arrow-left"></i> Back to Blog
            </a>

            <div class="post-header" id="postHeader">
                <div class="post-meta" id="postMeta">
                    <!-- Generated dynamically -->
                </div>
                <h1 class="post-title" id="postTitle">Loading...</h1>
            </div>

            <div class="post-content" id="postContent">
                <!-- Generated dynamically -->
            </div>

            <div class="post-tags" id="postTags" style="display: none;">
                <strong style="color: #64748b; font-size: 0.9rem;">Tags:</strong>
                <div id="tagsList"></div>
            </div>
        </article>

        <!-- Related Posts - RIGHT -->
        <aside class="related-sidebar">
            <div class="related-card">
                <h3><i class="fas fa-newspaper"></i> Related Posts</h3>
                <div id="relatedPosts">
                    <!-- Generated dynamically -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column footer-logo">
                    <div class="logo" style="color: white; margin-bottom: 1.5rem;">
                        <img src="./assets/whitezebra.jpeg" alt="Whitezebra Consulting" class="logo-img" style="height: 50px;">
                        <span>Whitezebra Consulting</span>
                    </div>
                    <p>Your trusted offshore operations partner delivering premium backend support services for digital businesses worldwide.</p>
                    <div class="social-links">
                        <a href="https://www.linkedin.com/company/whitezebraconsulting/" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-column footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> Phulbari Nagar Marg, Kathmandu 44600, Nepal</p>
                    <p><i class="fas fa-phone"></i> +977-9851324698</p>
                    <p><i class="fas fa-envelope"></i> info.whitezebraconsulting@gmail.com</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Whitezebra Consulting Pvt. Ltd. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../script.js"></script>
    <script>
        let currentPost = null;

        // Load blog post
        async function loadBlogPost() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');

            if (!slug) {
                window.location.href = 'blog.html';
                return;
            }

            try {
                const response = await fetch(`./blogs/${slug}.json`);
                if (!response.ok) throw new Error('Post not found');
                
                currentPost = await response.json();

                // Render post
                renderPost(currentPost);
                
                // Load related posts
                loadRelatedPosts(currentPost);
                
                // Generate TOC
                generateTableOfContents();

            } catch (error) {
                console.error('Error loading post:', error);
                document.getElementById('postTitle').textContent = 'Post Not Found';
                document.getElementById('postContent').innerHTML = '<p>Sorry, we couldn\'t find this blog post.</p>';
            }
        }

        function renderPost(post) {
            // Meta
            document.getElementById('postMeta').innerHTML = `
                <div class="post-meta-item">
                    <i class="far fa-calendar"></i>
                    <span>${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                </div>
                <div class="post-meta-item">
                    <i class="far fa-clock"></i>
                    <span>${post.readTime}</span>
                </div>
                <div class="post-meta-item">
                    <i class="far fa-user"></i>
                    <span>${post.author}</span>
                </div>
            `;

            // Title
            document.getElementById('postTitle').textContent = post.title;
            document.title = `${post.title} | Whitezebra Consulting`;

            // Content
            let contentHTML = '';

            if (post.image) {
                contentHTML += `<img src="./blogs_images/${post.image}" alt="${post.title}" class="post-image">`;
            }

            contentHTML += `<p class="post-excerpt">${post.content.introduction}</p>`;

            post.content.sections.forEach(section => {
                contentHTML += `
                    <h2 id="${slugify(section.heading)}">${section.heading}</h2>
                    <p>${section.content}</p>
                `;
            });

            document.getElementById('postContent').innerHTML = contentHTML;

            // Tags
            if (post.tags && post.tags.length > 0) {
                document.getElementById('postTags').style.display = 'block';
                document.getElementById('tagsList').innerHTML = post.tags.map(tag => 
                    `<span class="tag">${tag}</span>`
                ).join('');
            }
        }

        function generateTableOfContents() {
            const headings = document.querySelectorAll('.post-content h2');
            const tocList = document.getElementById('tocList');
            
            if (headings.length === 0) {
                tocList.innerHTML = '<li style="color: #9ca3af; font-size: 0.85rem;">No sections found</li>';
                return;
            }

            tocList.innerHTML = Array.from(headings).map(heading => `
                <li>
                    <a href="#${heading.id}">${heading.textContent}</a>
                </li>
            `).join('');

            // Smooth scroll
            tocList.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const id = link.getAttribute('href').slice(1);
                    document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
                });
            });
        }

        async function loadRelatedPosts(currentPost) {
            try {
                // Load all blog filenames
                const blogFiles = [
                    'digital-marketing-trends-2024',
                    'shopify-store-management',
                    'shopify-best-practice',
                    'digital-marketing-upcoming-trends',
                    'offshore-backend-operations'
                ];

                let relatedPosts = [];

                for (const file of blogFiles) {
                    if (file === currentPost.slug) continue; // Skip current post

                    try {
                        const response = await fetch(`./blogs/${file}.json`);
                        if (response.ok) {
                            const post = await response.json();
                            
                            // Check if related by tags
                            const hasCommonTag = post.tags?.some(tag => currentPost.tags?.includes(tag));
                            if (hasCommonTag) {
                                relatedPosts.push({ ...post, isRelated: true });
                            } else {
                                relatedPosts.push({ ...post, isRelated: false });
                            }
                        }
                    } catch (e) {
                        console.log('Couldn\'t load:', file);
                    }
                }

                // Sort: related first, then by date
                relatedPosts.sort((a, b) => {
                    if (a.isRelated && !b.isRelated) return -1;
                    if (!a.isRelated && b.isRelated) return 1;
                    return new Date(b.date) - new Date(a.date);
                });

                // Show top 3
                renderRelatedPosts(relatedPosts.slice(0, 3));

            } catch (error) {
                console.error('Error loading related posts:', error);
            }
        }

        function renderRelatedPosts(posts) {
            const container = document.getElementById('relatedPosts');
            
            if (posts.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; font-size: 0.9rem;">No related posts found</p>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="related-post">
                    <a href="blog-post.html?slug=${post.slug}" class="related-post-title">
                        ${post.title}
                    </a>
                    <div class="related-post-meta">
                        ${new Date(post.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} â€¢ ${post.readTime}
                    </div>
                </div>
            `).join('');
        }

        function slugify(text) {
            return text.toLowerCase().replace(/[^\w]+/g, '-');
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', loadBlogPost);
    </script>
</body>
</html>
